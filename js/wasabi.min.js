Wasabi=window.Wasabi||{},Wasabi.version="0.0.0",Wasabi.Utils={addClass:function(a,b){for(var c=a.getAttribute("class")||"",d=b.split(/ +/),e=new RegExp("\\b"+d[0]+"\\b"),f=0;f<d.length;f++)e=new RegExp("\\b"+d[f]+"\\b"),c.match(e)||(c+=" "+d[f]);a.setAttribute("class",c.replace(/ +/g," "))},removeClass:function(a,b){for(var c=a.getAttribute("class")||"",d=b.split(/ +/),e=new RegExp("\b"+d[0]+"\b"),f=0;f<d.length;f++)e=new RegExp("\\b"+d[f]+"\\b"),c=c.replace(e,"");a.setAttribute("class",c)},states:[["open","closed"],["visible","hidden"],["enabled","disabled"],["focused","unfocused"],["unloaded","loading","loaded"]],classState:function(a,b){for(var c=Wasabi.Utils.states,d=0;d<c.length;d++)c[d].indexOf(b)>-1&&(Wasabi.Utils.removeClass(a,c[d].join(" ")),Wasabi.Utils.addClass(a,b))},getter:function(a){return function(){return a}},extend:function(a,b){for(var c in b)"prototype"!==c&&(a[c]=b[c])},createEl:function(a){var b=a,c=b.match(/^[a-zA-Z0-9]+/),d=b.match(/\.[-_a-zA-Z0-9]+/g),e=b.match(/#[-_a-zA-Z0-9]+/),f=document.createElement(c?c[0]:"div");return e&&(f.id=e),d&&(d=d.join(" ").replace(/\./g,""),Wasabi.Utils.addClass(f,d)),f}},Wasabi.createEl=Wasabi.Utils.createEl,Wasabi.getter=Wasabi.Utils.getter,Wasabi.extend=Wasabi.Utils.extend,Wasabi.entrify=function(a,b){function c(a,b){var c=new RegExp("^(\\s+"+b+" ?|$)"),d=new RegExp("\\s*"+b+".*$"),e=/^\s*$/,f=a.split(/\n/),g=null,h=null,i="",j=[],k=0,l=f[0],m=[],n=0;for(n=1;n<f.length;n++)if(!f[n].match(c)&&!f[n].match(e)){g=f[n].match(/^\s+/)[0];break}for(h=new RegExp("^"+g),n=0;n<f.length;n++)if(l=f[n],!l.match(e))if(l.match(c))i+="\n"+l.replace(c,"");else{for(i.length>0&&m.push(i),i="",k=0;l.match(h);)l=l.replace(h,""),k++;i=(l.match(d)||[b])[0],j.length=k,j.push(l.replace(d,"").trim()),i=j.join("")+" "+i}return m.push(i),m}function d(a,b){for(var c=[],d=a.split("\n"),e=d[0],f="",g=/^\S/,h=new RegExp(b),i=0;i<d.length;i++)e=d[i],e.match(g)?(f.length&&c.push(f),f=e,f.match(h)||(f+=" "+b+" ")):f+="\n"+e;return c.push(f),c}a=a.trim();for(var e=a.split(/\r?\n/),f=[],g=new RegExp("^\\s*("+b+" ?|$)"),h="",i={comments:[],entries:[]};e[0].match(g);)h=e.shift(),h=h.replace(g,"").trim(),i.comments.push(h);i.comments=i.comments.join("\n"),e=e.join("\n"),f=e.match(/\n\S/m)?d(e,b):c(e,b);for(var j in f)i.entries.push(new Wasabi.Entry(f[j]));return i},Wasabi.pluginable=function(a){a||(a={});var b={},c=a.mandatory?[].concat(a.mandatory):[],d=a.optional?[].concat(a.optional):[],e=[];return{addPlugin:function(a,c){b[a]=c},reset:function(){e.length=0},extras:d,call:function(){var a=Array.prototype.slice.call(arguments,0),d=c[0],f=null,g=0;for(g=0;g<c.length;g++){d=c[g];for(f in b)f.match(d)&&-1===e.indexOf(f)&&(b[f].apply(null,a),e.push(f))}for(g=0;g<this.extras.length;g++){d=this.extras[g];for(f in b)f.match(d)&&-1===e.indexOf(f)&&(b[f].apply(null,a),e.push(f))}e.length=0}}},Wasabi.Entry=function(a){this._source=a.trim(),"object"==typeof arguments[arguments.length]&&Wasabi.extend(this.options,arguments[arguments.length]),this._plugins.call(this)},Wasabi.Entry.prototype={options:{rootChar:".",dirChar:"/",commentChar:"#"},_plugins:Wasabi.pluginable({mandatory:[/^init:initialize$/,/^init:types$/,/^data:/,/^dom:basics$/,/^dom:/,/^api:/],optional:[/^interface:/,/^basic:/]})},Wasabi.Entry.addPlugin=Wasabi.Entry.prototype._plugins.addPlugin,Wasabi.Project=function(a,b){if("object"==typeof b&&Wasabi.extend(this.options,b),this._source="",this._sourceNode=null,a.textContent)this._source=a.textContent,this._sourceNode=a;else if("string"==typeof a)if(a.match(/\n/m))this._source=a;else{if(this._sourceNode=document.getElementById(a.replace(/[ #]/g,"")),!this._sourceNode)throw new Error("couldn't init project with \n"+a);this._source=this._sourceNode.textContent}var c=Wasabi.entrify(this._source,this.options.commentChar);this._comments=c.comments,this.options.plugins&&(this._initPlugins.extra=this.options.plugins),this._initPlugins.call(this);for(var d in c.entries)this.addEntry(c.entries[d])},Wasabi.Project.prototype={options:{commentChar:"#",autoReplace:!0},_initPlugins:Wasabi.pluginable({mandatory:[/^core:/],optional:[/^basic:/]})},Wasabi.Project.addPlugin=Wasabi.Project.prototype._initPlugins.addPlugin,Wasabi.Entry.addPlugin("api:addChild",function(a){if("directory"===a._type){var b=Wasabi.createEl("ul.entry-children");a.dom.getChildContainer=Wasabi.getter(b),a._children={},a.dom.getContainer().appendChild(b),a.addChild=function(a){return!a instanceof Wasabi.Entry?this:(this._children[a._name]=a,a._parent=this,this.dom.getChildContainer().appendChild(a.dom.getContainer()),this)}}}),Wasabi.Entry.addPlugin("api:closable-directories",function(a){"directory"===a._type&&a.addClass("closable"),a.close=function(){return this.state("closed"),this},a.open=function(){return this.state("open"),this},a.openPath=function(){return this.open(),this._parent&&this._parent.openPath(),this},a.open()}),Wasabi.Entry.addPlugin("api:disableable",function(a){a.disable=function(){return this.state("disabled"),this.dom.getContainer().setAttribute("aria-disabled","true"),this},a.enable=function(){return this.state("enabled"),this.dom.getContainer().setAttribute("aria-disabled","false"),this},a.enable()}),Wasabi.Entry.addPlugin("dom:basics",function(a){var b=Wasabi.createEl("li.wasabi-entry.open"),c=Wasabi.createEl("button.entry-name.type-"+a._type),d=Wasabi.createEl("div.wasabi-entry-comment.unfocused");a.dom={getContainer:Wasabi.getter(b),getName:Wasabi.getter(c)},a.state=Wasabi.Utils.classState.bind(null,b),a.addClass=Wasabi.Utils.addClass.bind(null,b),a.removeClass=Wasabi.Utils.removeClass.bind(null,b),c.innerHTML=a._name,b.appendChild(c),a._comments&&(d.innerHTML=a._comments,a.dom.getComments=Wasabi.getter(d))}),Wasabi.Entry.addPlugin("api:focusable",function(a){a.dom.getComments&&a.addClass("has-comments"),a.unfocus=function(){this.state("unfocused"),this.dom.getComments&&Wasabi.Utils.classState(this.dom.getComments(),"hidden")},a.focus=function(){this.getProject&&this.getProject().eachEntry(function(a){a.unfocus()}),this.dom.getComments&&(Wasabi.Utils.classState(this.dom.getComments(),"visible"),this.state("focused"))},a.unfocus()}),Wasabi.Entry.addPlugin("init:initialize",function(a){var b=a.options.commentChar,c=new RegExp(a.options.commentChar+"(.|[\n\r])*","m"),d=new RegExp(a.options.commentChar+" ?"),e=new RegExp("^[^"+b+"]+"),f=new RegExp("[*@"+a.options.dirChar+"]$"),g=a._source.match(c);a._comments=g?g[0].replace(d,""):"";var h=a._source.match(e);if(!h)throw new Error("couldn't pull path from = "+a._source);a._pathString=h=h[0].trim(),a._path=a._pathString.replace(f,"").split(a.options.dirChar),a._name=a._path[a._path.length-1]}),Wasabi.Entry.addPlugin("interface:hover-focus",function(a){var b=a.dom.getName(),c=a.dom.getContainer();b.addEventListener("mouseenter",function(){a.focus()}),b.addEventListener("dblclick",function(b){b.stopPropagation(),b.preventDefault(),c.getAttribute("class").match(/\bopen\b/)?a.close():a.open()})}),Wasabi.Entry.addPlugin("init:types",function(a){var b=[{type:"executable",matcher:/\*$/},{type:"directory",matcher:/\/$/},{type:"symlink",matcher:/@$/},{type:"file",matcher:/./}],c=a._name.replace(/^\./,"").match(/\.([a-zA-Z]+)(?=(\.|$))/g)||[];if(b.every(function(b){return a._pathString.match(b.matcher)?(a._type=b.type,!1):!0}),"file"===a._type||"executable"===a._type){for(var d=0;d<c.length;d++)c[d]=c[d].replace(/[^-a-z_A-Z]/g,"");a._filetypes=c}}),Wasabi.Project.addPlugin("core:dom",function(a){var b=Wasabi.createEl(".wasabi-project"),c=Wasabi.createEl(".project-content.two-column"),d=Wasabi.createEl(".project-comments"),e=Wasabi.createEl(".project-toolbar.hidden"),f=Wasabi.createEl("ul.project-entries");b.appendChild(c),c.appendChild(e),c.appendChild(d),c.appendChild(f),a.dom={getContainer:Wasabi.getter(b),getEntries:Wasabi.getter(f),getToolbar:Wasabi.getter(e),getComments:Wasabi.getter(d)}}),Wasabi.Project.addPlugin("core:each-entry",function(a){a.eachEntry=function(a){function b(a,c){if(c(a),a._children)for(var d in a._children)b(a._children[d],c)}var c=this.getRoot();b(c,a)}}),Wasabi.Project.addPlugin("core:insert",function(a){a.replace=function(b){b?"string"==typeof b&&(b=document.getElementById(b.replace(/[ #]/g,""))):a._sourceNode&&(b=a._sourceNode),b.parentNode.insertBefore(a.dom.getContainer(),b),b.parentNode.removeChild(b)}}),Wasabi.Project.addPlugin("core:nest-children",function(a){a.getEntry=function(a){var b=this.getRoot();for("string"==typeof a&&(a=a.split(this.options.dirChar)),a=a.splice(1,a.length-1);a.length;){if(!b._children||!b._children.hasOwnProperty(a[0]))return!1;b=b._children[a[0]],a.shift()}return b},a.addEntry=function(b){var c=!1;return b.getProject=Wasabi.getter(this),b.dom.getComments&&a.dom.getComments().appendChild(b.dom.getComments()),this.getRoot?(c=this.getEntry(b._path.slice(0,b._path.length-1)),c.addChild?c.addChild(b):console.log("parent directory doesn't exist for "+b._name)):(this.getRoot=Wasabi.getter(b),this.dom.getEntries().appendChild(b.dom.getContainer())),this}}),Wasabi.Entry.addPlugin("basic:control",function(a){if(a._comments){var b=a.dom.getComments(),c=Wasabi.createEl("h5.comment-header");c.innerHTML=a._pathString.replace(/^[^\/]+/,"~"),b.insertBefore(c,b.childNodes[0])}}),Wasabi.Project.addPlugin("basic:control",function(a){var b=Wasabi.createEl,c=b("button.open-button.control-button"),d=b("input.wasabi-search-bar"),e=(a.dom.getContainer(),a.dom.getToolbar());d.setAttribute("type","text"),c.innerHTML="open all",e.appendChild(d),e.appendChild(c),c.addEventListener("click",function(){a.eachEntry(function(a){a.open()})}),d.addEventListener("input",function(){var b=[],c=d.value.trim(),e=new RegExp(c,"i");a.eachEntry(function(a){return c?(a.close().disable(),void(a._name.match(e)&&b.push(a))):a.enable().open()});for(var f in b)b[f].openPath().enable()})});